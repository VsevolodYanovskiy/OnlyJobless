name: CI Tests

on:
  push:
  pull_request:

jobs:
  test:
    name: Run Tests
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12.5'
        cache: 'pip'
    
    - name: ğŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f docs/requirements.txt ]; then
          pip install -r docs/requirements.txt
        fi
        pip install pytest pytest-cov
    
    - name: ğŸ§ª Run tests
      env:
        SECRET_KEY: github-actions-test-key-${{ github.sha }}
        ALGORITHM: HS256
        ENVIRONMENT: test
      run: |
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ñ‚ĞµÑÑ‚Ñ‹ Ğ¿ĞµÑ€ĞµĞ´ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ¼
        if [ ! -d "tests" ] || [ -z "$(find tests -name '*.py' -type f 2>/dev/null)" ]; then
          echo "âœ… No test files found - SUCCESS"
          exit 0
        fi
        python -m pytest tests/ -v --tb=short
    
    - name: ğŸ“Š Check code formatting
      run: |
        pip install black
        black --check src/ tests/ || echo "Formatting check failed"
    
    - name: ğŸ” Lint code
      run: |
        pip install flake8
        flake8 src/ --count --max-line-length=120 || echo "Linting check failed"